{
    auto_https off
    admin off
}


:8080 {
    log {
        output stdout
        format json
        level WARN
    }

    header {
        # security headers
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Frame-Options "DENY"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "no-referrer"
        Permissions-Policy "geolocation=(), microphone=(), camera=()"
        Content-Security-Policy "default-src 'self'; script-src 'self'; object-src 'none'"
        X-Permitted-Cross-Domain-Policies "none"
        Clear-Site-Data "\"cache\", \"cookies\", \"storage\""
        Cross-Origin-Embedder-Policy "require-corp"
        Cross-Origin-Opener-Policy "same-origin"
        Cross-Origin-Resource-Policy "same-origin"
    }

    route {
        waf {
            anomaly_threshold 10
            block_countries GeoLite2-Country.mmdb RU CN KP
            # or whitelist
            # whitelist_countries GeoLite2-Country.mmdb US
            rate_limit 1000 1m  
            rule_file rules.json
            ip_blacklist_file ip_blacklist.txt
            dns_blacklist_file dns_blacklist.txt

            log_severity warn
            log_json
        }

        respond "Hello, world!" 200
    }
}

