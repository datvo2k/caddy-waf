[
    {
        "id": "allow-legit-browsers",
        "phase": 1,
        "pattern": "(?i)(Mozilla|Chrome|Safari|Edge|Firefox|Opera|AppleWebKit|Gecko|Trident|MSIE|Googlebot|Bingbot|Slurp|DuckDuckBot|Baiduspider|YandexBot|Sogou|Exabot|facebot|facebookexternalhit)",
        "targets": ["HEADERS:User-Agent"],
        "severity": "LOW",
        "action": "log",
        "score": 0,
        "description": "Allow and log traffic from legitimate browsers and search engine crawlers."
    },
    {
        "id": "log-legit-tools",
        "phase": 1,
        "pattern": "(?i)(wget|curl|libwww-perl|python-requests|Go-http-client|Java|HttpClient|axios|PostmanRuntime|Paw|Insomnia|Fiddler|Charles)",
        "targets": ["HEADERS:User-Agent"],
        "severity": "MEDIUM",
        "action": "log",
        "score": 2,
        "description": "Log traffic from legitimate tools like wget, curl, and API testing tools."
    },
    {
        "id": "block-scanners",
        "phase": 1,
        "pattern": "(?i)(nikto|sqlmap|nmap|acunetix|nessus|openvas|wpscan|dirbuster|burpsuite|owasp zap|netsparker|appscan|arachni|skipfish|gobuster|wfuzz|hydra|metasploit|nessus|openvas|qualys|zap|w3af|openwebspider|netsparker|appspider|rapid7|nessus|qualys)",
        "targets": ["HEADERS:User-Agent"],
        "severity": "CRITICAL",
        "action": "block",
        "score": 10,
        "description": "Block traffic from known vulnerability scanners and penetration testing tools."
    },
    {
        "id": "block-bad-bots",
        "phase": 1,
        "pattern": "(?i)(ahrefsbot|semrushbot|mj12bot|dotbot|petalbot|blexbot|rogerbot|exabot|megaindex|linkdexbot|spbot|sistrix|xoviobot|yandeximages|baiduspider|yandexbot|sogou|exabot|facebot|facebookexternalhit|python-requests|Go-http-client|Java|HttpClient|axios|PostmanRuntime|masscan|zgrab|ja3|ja3s|badbot|evilbot|maliciousbot|spammerbot|scrapy|phantomjs|headlesschrome|headlessfirefox)",
        "targets": ["HEADERS:User-Agent"],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Block traffic from known bad bots and automated scripts."
    },
    {
        "id": "block-suspicious-user-agents",
        "phase": 1,
        "pattern": "(?i)(bot|crawl|spider|scan|hack|exploit|inject|sql|xss|bypass|brute|force|attack|malware|phishing|spyware|adware|ransomware|trojan|virus|worm|keylogger|backdoor|rootkit|shellcode|payload|exploit|vulnerability|scanner|harvest|scrape|collect|grab|fetch|extract|parse|analyze|monitor|track|log|record|report|submit|send|receive|execute|run|launch|start|stop|kill|terminate|restart|reboot|shutdown|suspend|resume|pause|wait|sleep|delay|timeout|retry|repeat|loop|cycle|iterate|recur|recurse|recurring|recurrent|recursive|recursion)",
        "targets": ["HEADERS:User-Agent"],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Block traffic with suspicious or malicious User-Agent strings."
    },
    {
        "id": "block-no-user-agent",
        "phase": 1,
        "pattern": "^$",
        "targets": ["HEADERS:User-Agent"],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Block traffic with missing or empty User-Agent headers."
    },
    {
        "id": "block-headless-browsers",
        "phase": 1,
        "pattern": "(?i)(headlesschrome|headlessfirefox|phantomjs|puppeteer|selenium|playwright|electron|chrome-lighthouse)",
        "targets": ["HEADERS:User-Agent"],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Block traffic from headless browsers and automation frameworks."
    },
    {
        "id": "block-suspicious-tools",
        "phase": 1,
        "pattern": "(?i)(sqlmap|hydra|metasploit|nmap|nikto|wpscan|dirbuster|burpsuite|owasp zap|netsparker|appscan|arachni|skipfish|gobuster|wfuzz|masscan|zgrab|ja3|ja3s)",
        "targets": ["HEADERS:User-Agent"],
        "severity": "CRITICAL",
        "action": "block",
        "score": 10,
        "description": "Block traffic from suspicious tools commonly used for attacks."
    },
    {
        "id": "block-unknown-bots",
        "phase": 1,
        "pattern": "(?i)(bot|crawler|spider|scanner|harvester|fetcher|grabber|collector|extractor|parser|analyzer|monitor|tracker|logger|recorder|reporter|submitter|sender|receiver|executor|runner|launcher|starter|stopper|killer|terminator|restarter|rebooter|shutdown|suspender|resumer|pauser|waiter|sleeper|delayer|timeouter|retrier|repeater|looper|cycler|iterator|recurrer|recurser|recurring|recurrent|recursive|recursion)",
        "targets": ["HEADERS:User-Agent"],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Block traffic from unknown or generic bots with suspicious behavior."
    },
    {
        "id": "block-evasion-attempts",
        "phase": 1,
        "pattern": "(?i)(obfuscate|encode|decode|encrypt|decrypt|base64|hex|urlencode|urldecode|rot13|xor|aes|des|rc4|md5|sha1|sha256|sha512|hmac|jwt|token|bearer|oauth|api_key|secret|password|credential|auth|authentication|session|cookie|csrf|xss|sql|inject|payload|exploit|vulnerability|bypass|brute|force|attack|malware|phishing|spyware|adware|ransomware|trojan|virus|worm|keylogger|backdoor|rootkit|shellcode|payload|exploit|vulnerability|scanner|harvest|scrape|collect|grab|fetch|extract|parse|analyze|monitor|track|log|record|report|submit|send|receive|execute|run|launch|start|stop|kill|terminate|restart|reboot|shutdown|suspend|resume|pause|wait|sleep|delay|timeout|retry|repeat|loop|cycle|iterate|recur|recurse|recurring|recurrent|recursive|recursion)",
        "targets": ["HEADERS:User-Agent"],
        "severity": "CRITICAL",
        "action": "block",
        "score": 10,
        "description": "Block traffic with User-Agent strings indicating evasion or attack attempts."
    },
    {
        "id": "932130",
        "phase": 2,
        "pattern": "@rx \\$(?:\\((?:.*|\\(.*\\))\\)|\\{.*\\}|\\[.*\\])|[<>]\\(.*\\)|/[0-9A-Z_a-z]*\\[!?.+\\]",
        "targets": [
            "ARGS",
            "REQUEST_COOKIES"
        ],
        "severity": "LOW",
        "action": "log",
        "score": 1,
        "description": "No description provided."
    },
    {
        "id": "932200",
        "phase": 2,
        "pattern": "@rx ['\\*\\?\\x5c`][^\\n/]+/|/[^/]+?['\\*\\?\\x5c`]|\\$[!#\\$\\(\\*\\-0-9\\?-\\[_a-\\{]",
        "targets": [
            "ARGS",
            "REQUEST_COOKIES"
        ],
        "severity": "LOW",
        "action": "log",
        "score": 1,
        "description": "No description provided."
    },
    {
        "id": "942440",
        "phase": 2,
        "pattern": "@rx /\\*!?|\\*/|[';]--|--(?:[\\s\\x0b]|[^\\-]*?-)|[^&\\-]#.*?[\\s\\x0b]|;?\\x00",
        "targets": [
            "ARGS",
            "REQUEST_COOKIES"
        ],
        "severity": "LOW",
        "action": "log",
        "score": 1,
        "description": "No description provided."
    },
    {
        "id": "sql-injection",
        "phase": 2,
        "pattern": "(?i)(?:\\b(?:select|insert|update|delete|drop|alter|truncate|create|grant|revoke)\\b(?:\\s|\\/\\*.*?\\*\\/|--.*?)?(?:from|into|where|table|index|user|procedure|function|database)\\b|\\bunion\\b(?:\\s|\\/\\*.*?\\*\\/|--.*?)?(?:all|distinct)?(?:\\s|\\/\\*.*?\\*\\/|--.*?)?\\bselect\\b|'\\s*(?:and|or)\\s*['\\d]+\\s*(?:=|[<>]=?|!=)\\s*['\\d]+|\\)\\s*(?:and|or)\\s*\\([\\d]+\\s*(?:=|[<>]=?|!=)\\s*[\\d]+\\)|\\b(?:sleep|benchmark|waitfor\\s+delay)\\s*\\(|(?:\\bexec\\b|xp_cmdshell))",
        "targets": [
            "ARGS",
            "BODY",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 7,
        "description": "Block SQL injection attempts in request arguments, body, and headers."
    },
    {
        "id": "xss",
        "phase": 2,
        "pattern": "(?i)(?:<script[^>]*>|<img[^>]*\\s+onerror=|javascript:|data:|vbscript:|<svg[^>]*\\s+onload=|alert\\(|document\\.(?:cookie|location)|eval\\(|base64_(?:encode|decode)|expression\\(|\\b(?:on(?:mouse(?:over|out|down|up|move)|focus|blur|click|key(?:press|down|up)|load|error|submit|reset|change))\\s*=|\\bstyle\\s*=)",
        "targets": [
            "ARGS",
            "BODY",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 6,
        "description": "Block XSS attempts using HTML tags, event handlers, javascript: protocol."
    },
    {
        "id": "path-traversal",
        "phase": 2,
        "pattern": "(?:\\.\\.[/\\\\]|\\.\\./|\\.\\.\\\\/|%2e%2e[/\\\\]|%2e%2e/|%2e%2e%5c|%252e%252e|\\b(?:etc(?:\\/|%2F)(?:passwd|shadow|hosts)|(?:proc|sys)(?:\\/|%2F)(?:self(?:\\/|%2F)environ|cmdline)|boot(?:\\/|%2F)grub(?:\\/|%2F)grub.cfg)\\b)",
        "targets": [
            "URI",
            "ARGS",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 9,
        "description": "Block path traversal attempts and direct access to sensitive files (Target: URI, ARGS, HEADERS)."
    },
    {
        "id": "rce-commands",
        "phase": 2,
        "pattern": "(?i)(?:\\b(?:cat|base64|whoami|echo|curl|wget|bash|sh|python|perl)\\b)",
        "targets": [
            "ARGS",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 3,
        "description": "Block common commands used in RCE attempts."
    },
    {
        "id": "rce-separators",
        "phase": 2,
        "pattern": "(?i)(?:`[^`]+`|\\b(?:;|\\|\\||&&|\\n|%0a|%0d)\\s*(?:rm|cat|echo|curl|wget|python|php|jsp|cmd|exec|system|passthru|shell_exec|exec|system|popen|pcntl_exec))",
        "targets": [
            "ARGS",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 7,
        "description": "Block command separators followed by specific commands in ARGS and headers."
    },
    {
        "id": "log4j-exploit",
        "phase": 2,
        "pattern": "(?i)(?:\\$\\{jndi:(?:ldap|rmi|dns|iiop|corba|nds|nis|http|ldaps|rmi|nis|custom)://[^}]+\\}|\\$\\{(?:env|sys|java|lower|upper|logger|ctx|date|threadcontext|marker):[^}]+\\}|\\$\\{.*?\\:.*?\\})",
        "targets": [
            "ARGS",
            "BODY",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 9,
        "description": "Block Log4j exploit attempts using JNDI and environment variables."
    },
    {
        "id": "header-attacks",
        "phase": 2,
        "pattern": "(?i)(?:1'\\s+OR\\s+'1'='1|<script[^>]*>|\\.\\.\\/\\.\\.\\/etc\\/passwd|1'\\s+UNION\\s+SELECT\\s+NULL--|\\b(?:select|insert|update|delete|drop|alter)\\b[\\s\\S]*?\\b(?:from|into|where|table)\\b|\\bunion\\b[\\s\\S]*?\\bselect\\b|'\\s*(?:and|or)\\s*['\\d]+\\s*(?:=|[<>]=?|!=)\\s*['\\d]+|\\)\\s*(?:and|or)\\s*\\([\\d]+\\s*(?:=|[<>]=?|!=)\\s*[\\d]+\\)|\\b(?:sleep|benchmark|waitfor\\s+delay)\\s*\\()",
        "targets": [
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Block SQL injection, XSS, and path traversal attempts in headers."
    },
    {
        "id": "sensitive-files",
        "phase": 1,
        "pattern": "(?i)(?:/\\.git/(?:HEAD|index|config|refs|objects)|/\\.env(?:\\.local|\\.dev|\\.prod)?$|/\\.htaccess$|/\\.htpasswd$|/\\.svn/|/\\.DS_Store$|\\/WEB-INF\\/|\\/WEB-INF\\/web.xml|\\/META-INF\\/)",
        "targets": [
            "URI"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 9,
        "description": "Block access to sensitive files and directories (Target: URI)."
    },
    {
        "id": "unusual-paths",
        "phase": 1,
        "pattern": "(?i)(?:/wp-admin|/phpmyadmin|/admin|/login|/cgi-bin|/shell|/backdoor|/cmd|/exec|/bin/(?:sh|bash|zsh)|/console|/setup|/test)",
        "targets": [
            "URI"
        ],
        "severity": "MEDIUM",
        "action": "block",
        "score": 7,
        "description": "Block requests to unusual or suspicious paths (Target: URI)."
    },
    {
        "id": "mass-assignment-indicators",
        "phase": 2,
        "pattern": "(?i)(?:.*?\\[.*?\\]=.*?){3,}",
        "targets": [
            "ARGS"
        ],
        "severity": "MEDIUM",
        "action": "log",
        "score": 5,
        "description": "Log requests with numerous array-like parameter assignments."
    },
    {
        "id": "exposed-admin-panels-no-referer",
        "phase": 1,
        "pattern": "(?i)^(?:/wp-admin|/phpmyadmin|/admin|/login|/cpanel|/administrator|/webmin|/siteadmin|/config)",
        "targets": [
            "URI"
        ],
        "severity": "LOW",
        "action": "log",
        "score": 3,
        "description": "Log requests to common admin panel paths."
    },
    {
        "id": "exposed-admin-panels-no-referer-condition",
        "phase": 1,
        "pattern": "^$",
        "targets": [
            "HEADERS"
        ],
        "severity": "LOW",
        "action": "log",
        "score": 3,
        "description": "Log requests to common admin panel paths without a Referer header (needs to be used in conjunction with 'exposed-admin-panels-no-referer' with a conditional)."
    },
    {
        "id": "username-enumeration-login-page",
        "phase": 2,
        "pattern": "(?i)(?:\\buser(?:name)?\\b.*?(?:invalid|incorrect|not\\s+found))",
        "targets": [
            "BODY"
        ],
        "severity": "LOW",
        "action": "log",
        "score": 2,
        "description": "Log login responses that might indicate username enumeration vulnerabilities."
    },
    {
        "id": "high-scoring-cookies",
        "phase": 2,
        "pattern": "your_session_cookie_name=.*?(vulnerable_pattern|suspicious_value)",
        "targets": [
            "COOKIES"
        ],
        "severity": "MEDIUM",
        "action": "log",
        "score": 5,
        "description": "Log requests with specific patterns or values in important cookies (customize cookie name and pattern)."
    },
    {
        "id": "suspicious-auth-headers",
        "phase": 2,
        "pattern": "(?i)Authorization: Basic\\s+[a-zA-Z0-9+/=]{0,}",
        "targets": [
            "HEADERS"
        ],
        "severity": "LOW",
        "action": "log",
        "score": 2,
        "description": "Log requests with potentially incomplete or suspicious Basic Authentication headers."
    },
    {
        "id": "crlf-injection-headers",
        "phase": 2,
        "pattern": "(?i)(%0d|\\r)%0a|%0a(%0d|$)|\\n",
        "targets": [
            "HEADERS"
        ],
        "severity": "MEDIUM",
        "action": "log",
        "score": 5,
        "description": "Log requests with potential CRLF injection characters in headers."
    },
    {
        "id": "rce-command-injection-args",
        "phase": 2,
        "pattern": "(?i)(?:\\b(?:system|exec|shell_exec|passthru|popen|proc_open|pcntl_exec)\\s*\\([^\\)]*\\)|`[^`]+`|;|\\|\\||&&|\\n|%0a|%0d)",
        "targets": [
            "ARGS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Block potential RCE attempts via command injection in request arguments."
    },
    {
        "id": "rce-file-access-headers",
        "phase": 2,
        "pattern": "(?i)(?:(?:cat|more|less|head|tail)\\s+[^\\s]+(?:/etc/(?:passwd|shadow)|/proc/self/environ))",
        "targets": [
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 6,
        "description": "Block attempts to access sensitive files via command-like patterns in headers."
    },
    {
        "id": "sql-injection-common-keywords-body",
        "phase": 2,
        "pattern": "(?i)\\b(?:select\\s+.+\\s+from|insert\\s+into|update\\s+.+\\s+set|delete\\s+from|drop\\s+table|alter\\s+table|union\\s+select)\\b",
        "targets": [
            "BODY"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 7,
        "description": "Block common SQL injection keywords in request body."
    },
    {
        "id": "sql-injection-comment-bypass-args",
        "phase": 2,
        "pattern": "(?i)/\\*.*?\\*/|--\\s*\\r?\\n?$",
        "targets": [
            "ARGS"
        ],
        "severity": "MEDIUM",
        "action": "log",
        "score": 4,
        "description": "Log potential SQL injection comment bypass attempts in arguments."
    },
    {
        "id": "log4j-jndi-args",
        "phase": 2,
        "pattern": "(?i)\\$\\{jndi:(ldap|rmi|dns|iiop|corba|nds|nis|http|ldaps|rmi|nis)://[^}]*\\}",
        "targets": [
            "ARGS"
        ],
        "severity": "CRITICAL",
        "action": "block",
        "score": 9,
        "description": "Block Log4j JNDI injection attempts in request arguments."
    },
    {
        "id": "sql-injection-improved-basic",
        "phase": 2,
        "pattern": "(?i)(?:'\\s*(?:and|or)\\s*\\d+\\s*[=<>!]+\\s*\\d+|['\"]\\s*\\d+\\s*[=<>!]+\\s*['\"]|'\\s*\\+\\s*'|--\\s*-|-{2,}|\")",
        "targets": [
            "ARGS",
            "BODY",
            "HEADERS",
            "REQUEST_COOKIES"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Improved rule to catch basic SQL injection including quotes and boolean logic."
    },
    {
        "id": "xss-improved-encoding",
        "phase": 2,
        "pattern": "(?i)(?:<script[^>]*>|<img[^>]*\\s+onerror=|javascript:|data:|vbscript:|<svg[^>]*\\s+onload=|alert\\(|document\\.(?:cookie|location)|eval\\(|base64_(?:encode|decode)|expression\\(|\\b(?:on(?:mouse(?:over|out|down|up|move)|focus|blur|click|key(?:press|down|up)|load|error|submit|reset|change))\\s*=|\\bstyle\\s*=|(?:&#[xX]?[0-9a-fA-F]+;)+|%[0-9a-fA-F]{2,}|\\biframe[^>]*srcdoc\\s*=)",
        "targets": [
            "ARGS",
            "BODY",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Improved XSS rule to catch encoded payloads and iframe srcdoc."
    },
    {
        "id": "rce-commands-expanded",
        "phase": 2,
        "pattern": "(?i)(?:\\b(?:cat|base64|whoami|echo|curl|wget|bash|sh|python|perl|ls|id|ping|nslookup|ipconfig|ifconfig|powershell)\\b)",
        "targets": [
            "ARGS",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 5,
        "description": "Expanded rule to block more RCE related commands and utilities."
    },
    {
        "id": "rce-system-info-keywords",
        "phase": 2,
        "pattern": "(?i)(?:systeminfo|ver|uname\\s+-a|whoami)",
        "targets": [
            "ARGS",
            "HEADERS"
        ],
        "severity": "MEDIUM",
        "action": "block",
        "score": 6,
        "description": "Rule to block keywords related to system information gathering."
    },
    {
        "id": "header-suspicious-x-forwarded-for",
        "phase": 2,
        "pattern": "(?:127\\.0\\.0\\.1|10\\.|172\\.(?:1[6-9]|2\\d|3[01])\\.|192\\.168\\.)",
        "targets": [
            "HEADERS:X-Forwarded-For"
        ],
        "severity": "MEDIUM",
        "action": "block",
        "score": 6,
        "description": "Block requests with potentially internal IPs in X-Forwarded-For."
    },
    {
        "id": "sensitive-files-expanded",
        "phase": 1,
        "pattern": "(?i)(?:/\\.git/(?:HEAD|index|config|refs|objects)|/\\.env(?:\\.local|\\.dev|\\.prod)?$|/\\.htaccess$|/\\.htpasswd$|/\\.svn/|/\\.DS_Store$|\\/WEB-INF\\/|\\/WEB-INF\\/web.xml|\\/META-INF\\/|\\.git/\\s*(?:H\\.E\\.A\\.D|HEAD)|\\.dockerenv|server-status)",
        "targets": [
            "URI"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 9,
        "description": "Expanded rule to block access to more sensitive files and account for obfuscation."
    },
    {
        "id": "insecure-deserialization-java",
        "phase": 2,
        "pattern": "(?:rO0AB)",
        "targets": [
            "BODY",
            "HEADERS",
            "REQUEST_COOKIES"
        ],
        "severity": "CRITICAL",
        "action": "block",
        "score": 9,
        "description": "Block requests containing potential Java serialized objects."
    }
]
