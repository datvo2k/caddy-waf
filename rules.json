[
    {
        "id": "whitelist-root",
        "phase": 1,
        "pattern": "^/$",
        "targets": ["PATH"],
        "severity": "LOW",
        "action": "pass",
        "score": 0,
        "mode": "pass",
        "description": "Allow requests to the root path."
    },
    {
        "id": "whitelist-health",
        "phase": 1,
        "pattern": "^/(?:about|health|status|ping)$",
        "targets": ["PATH"],
        "severity": "LOW",
        "action": "pass",
        "score": 0,
        "mode": "pass",
        "description": "Allow requests to common health and status endpoints."
    },
    {
        "id": "scanner-detection",
        "phase": 1,
        "pattern": "(?i)(?:^(?:sqlmap|acunetix|nikto|nessus|netsparker|nmap|dirbuster|w3af|openvas|burpsuite|webinspect|qualys|commix|zap|arachni|gobuster|hydra|metasploit)(?:/|$))",
        "targets": ["USER_AGENT"],
        "severity": "CRITICAL",
        "action": "block",
        "score": 10,
        "mode": "block",
        "description": "Block requests from known security scanners based on User-Agent."
    },
    {
        "id": "sql-injection",
        "phase": 2,
        "pattern": "(?i)(?:select|insert|update|delete|drop|alter)(?:[\\s\\v\\/\\*]+)(?:from|into|where|table)\\b|(?:union(?:[\\s\\v\\/\\*]+)(?:all|distinct|select|null))|(?:[\"'])[\\s\\v]*(?:and|or|not|xor|div|like|between|[><]|>=|<=|!=|<>)[\\s\\v]*(?:\\d+|[\"']\\d+[\"']|(?:(?:select|union).+))",
        "targets": ["ARGS", "BODY", "HEADERS", "COOKIES"],
        "severity": "HIGH",
        "action": "block",
        "score": 5,
        "mode": "block",
        "description": "Block SQL injection attempts in request arguments, body, headers, and cookies."
    },
    {
        "id": "xss",
        "phase": 2,
        "pattern": "(?i)(?:<[^>]*(?:script|img|svg|iframe|frame|embed|object|applet)[^>]*>)|(?:on(?:abort|blur|change|click|dblclick|error|focus|keydown|keypress|keyup|load|mouse|move|reset|resize|select|submit|unload)\\s*=)|(?:javascript:)",
        "targets": ["ARGS", "BODY", "HEADERS", "COOKIES", "URL"],
        "severity": "HIGH",
        "action": "block",
        "score": 5,
        "mode": "block",
        "description": "Block XSS attempts using HTML tags, event handlers, and javascript: protocol."
    },
    {
        "id": "path-traversal",
        "phase": 2,
        "pattern": "(?:\\.\\.[/\\\\]|\\.\\./|\\.\\.\\\\/|%2e%2e[/\\\\]|%2e%2e/|%2e%2e%5c|%252e%252e)|(?i)(?:/etc/passwd|/etc/shadow|/etc/hosts)",
        "targets": ["ARGS", "PATH", "URI", "HEADERS"],
        "severity": "HIGH",
        "action": "block",
        "score": 5,
        "mode": "block",
        "description": "Block path traversal attempts and direct access to sensitive files."
    },
    {
        "id": "rce",
        "phase": 2,
        "pattern": "(?i)(?:[;|`]\\s*[\\w\\-]+\\s*[=\\s]|[;|`]\\s*[\\w\\-]+=.*?\\$\\(|[;|`]\\s*[\\w\\-]+\\s*\\$\\()|(?:;|\\|\\||&&|`|\\$\\()|(?:base64\\s*-d)",
        "targets": ["ARGS", "BODY", "HEADERS"],
        "severity": "HIGH",
        "action": "block",
        "score": 5,
        "mode": "block",
        "description": "Block remote code execution attempts using command separators, backticks, and base64-encoded commands."
    },
    {
        "id": "log4j-exploit",
        "phase": 2,
        "pattern": "(?i)(?:\\$\\{(?:jndi|java|sys|env|::|lower|upper|logger|ctx|date|threadcontext|marker):.*?\\}|\\$\\{\\$\\{.*?\\}\\})",
        "targets": ["ARGS", "BODY", "HEADERS", "COOKIES"],
        "severity": "HIGH",
        "action": "block",
        "score": 5,
        "mode": "block",
        "description": "Block Log4j exploit attempts using JNDI, environment variables, and other payloads."
    },
    {
        "id": "sensitive-files",
        "phase": 1,
        "pattern": "(?i)(?:/\\.git/(?:HEAD|index|config|refs)|/\\.env(?:\\.local|\\.dev|\\.prod)?$|/\\.htaccess$|/\\.htpasswd$|/\\.svn/|/\\.DS_Store$)",
        "targets": ["PATH", "URI"],
        "severity": "HIGH",
        "action": "block",
        "score": 5,
        "mode": "block",
        "description": "Block access to sensitive files and directories."
    },
    {
        "id": "csrf-detection",
        "phase": 2,
        "pattern": "(?i)(?:<input[^>]*name=[\"']csrf_token[\"'][^>]*>)",
        "targets": ["BODY"],
        "severity": "MEDIUM",
        "action": "block",
        "score": 3,
        "mode": "block",
        "description": "Block requests with missing or invalid CSRF tokens."
    },
    {
        "id": "file-upload-abuse",
        "phase": 2,
        "pattern": "(?i)(?:\\.(?:php|exe|sh|bat|jar|war|jsp|asp|aspx|pl|py|rb|cmd|bin))$",
        "targets": ["ARGS", "BODY"],
        "severity": "HIGH",
        "action": "block",
        "score": 5,
        "mode": "block",
        "description": "Block malicious file uploads."
    },
    {
        "id": "open-redirect",
        "phase": 2,
        "pattern": "(?i)(?:https?://(?:[^/]+\\.)?(?:example\\.com|evil\\.com|phishing\\.com))",
        "targets": ["ARGS", "BODY"],
        "severity": "MEDIUM",
        "action": "block",
        "score": 3,
        "mode": "block",
        "description": "Block open redirect attempts."
    },
    {
        "id": "xml-external-entity",
        "phase": 2,
        "pattern": "(?i)(?:<!ENTITY\\s+[^>]*(?:SYSTEM|PUBLIC)\\s+[^>]*>)",
        "targets": ["ARGS", "BODY"],
        "severity": "HIGH",
        "action": "block",
        "score": 5,
        "mode": "block",
        "description": "Block XML External Entity (XXE) injection attempts."
    },
    {
        "id": "httpoxy",
        "phase": 1,
        "pattern": "(?i)(?:Proxy:.*)",
        "targets": ["HEADERS"],
        "severity": "HIGH",
        "action": "block",
        "score": 5,
        "mode": "block",
        "description": "Block HTTPoxy vulnerability exploitation."
    },
    {
        "id": "session-fixation",
        "phase": 1,
        "pattern": "(?i)(?:Set-Cookie:.*(?:JSESSIONID|PHPSESSID|sessionid).*)",
        "targets": ["HEADERS"],
        "severity": "MEDIUM",
        "action": "block",
        "score": 3,
        "mode": "block",
        "description": "Block session fixation attempts."
    },
    {
        "id": "insecure-headers",
        "phase": 1,
        "pattern": "(?i)(?:Server:.*|X-Powered-By:.*)",
        "targets": ["HEADERS"],
        "severity": "LOW",
        "action": "block",
        "score": 1,
        "mode": "block",
        "description": "Block insecure server headers."
    }
]
