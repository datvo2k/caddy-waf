[
    {
        "id": "allow-legit-browsers",
        "phase": 1,
        "pattern": "(?i)(Mozilla|Chrome|Safari|Edge|Firefox|Opera|AppleWebKit|Gecko|Trident|MSIE|Googlebot|Bingbot|Slurp|DuckDuckBot|Baiduspider|YandexBot|Sogou|Exabot|facebot|facebookexternalhit)",
        "targets": ["HEADERS:User-Agent"],
        "severity": "LOW",
        "action": "log",
        "score": 0,
        "description": "Allow and log traffic from legitimate browsers and search engine crawlers."
    },  
    {
        "id": "block-scanners",
        "phase": 1,
        "pattern": "(?i)(nikto|sqlmap|nmap|acunetix|nessus|openvas|wpscan|dirbuster|burpsuite|owasp zap|netsparker|appscan|arachni|skipfish|gobuster|wfuzz|hydra|metasploit|nessus|openvas|qualys|zap|w3af|openwebspider|netsparker|appspider|rapid7|nessus|qualys)",
        "targets": ["HEADERS:User-Agent"],
        "severity": "CRITICAL",
        "action": "block",
        "score": 10,
        "description": "Block traffic from known vulnerability scanners and penetration testing tools."
    },  
    {
        "id": "942440",
        "phase": 2,
        "pattern": "@rx /\\*!?|\\*/|[';]--|--(?:[\\s\\x0b]|[^\\-]*?-)|[^&\\-]#.*?[\\s\\x0b]|;?\\x00",
        "targets": [
            "ARGS",
            "REQUEST_COOKIES"
        ],
        "severity": "LOW",
        "action": "log",
        "score": 1,
        "description": "No description provided."
    },  
    {
        "id": "sql-injection",
        "phase": 2,
        "pattern": "(?i)(?:\\b(?:select|insert|update|delete|drop|alter|truncate|create|grant|revoke)\\b(?:\\s|\\/\\*.*?\\*\\/|--.*?)?(?:from|into|where|table|index|user|procedure|function|database)\\b|\\bunion\\b(?:\\s|\\/\\*.*?\\*\\/|--.*?)?(?:all|distinct)?(?:\\s|\\/\\*.*?\\*\\/|--.*?)?\\bselect\\b|'\\s*(?:and|or)\\s*['\\d]+\\s*(?:=|[<>]=?|!=)\\s*['\\d]+|\\)\\s*(?:and|or)\\s*\\([\\d]+\\s*(?:=|[<>]=?|!=)\\s*[\\d]+\\)|\\b(?:sleep|benchmark|waitfor\\s+delay)\\s*\\(|(?:\\bexec\\b|xp_cmdshell))",
        "targets": [
            "ARGS",
            "BODY",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 7,
        "description": "Block SQL injection attempts in request arguments, body, and headers."
    },  
    {
        "id": "xss",
        "phase": 2,
        "pattern": "(?i)(?:<script[^>]*>|<img[^>]*\\s+onerror=|javascript:|data:|vbscript:|<svg[^>]*\\s+onload=|alert\\(|document\\.(?:cookie|location)|eval\\(|base64_(?:encode|decode)|expression\\(|\\b(?:on(?:mouse(?:over|out|down|up|move)|focus|blur|click|key(?:press|down|up)|load|error|submit|reset|change))\\s*=|\\bstyle\\s*=)",
        "targets": [
            "ARGS",
            "BODY",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 6,
        "description": "Block XSS attempts using HTML tags, event handlers, javascript: protocol."
    },  
    {
        "id": "path-traversal",
        "phase": 2,
        "pattern": "(?:\\.\\.[/\\\\]|\\.\\./|\\.\\.\\\\/|%2e%2e[/\\\\]|%2e%2e/|%2e%2e%5c|%252e%252e|\\b(?:etc(?:\\/|%2F)(?:passwd|shadow|hosts)|(?:proc|sys)(?:\\/|%2F)(?:self(?:\\/|%2F)environ|cmdline)|boot(?:\\/|%2F)grub(?:\\/|%2F)grub.cfg)\\b)",
        "targets": [
            "URI",
            "ARGS",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 9,
        "description": "Block path traversal attempts and direct access to sensitive files (Target: URI, ARGS, HEADERS)."
    },  
    {
        "id": "rce-commands",
        "phase": 2,
        "pattern": "(?i)(?:\\b(?:cat|base64|whoami|echo|curl|wget|bash|sh|python|perl)\\b)",
        "targets": [
            "ARGS",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 3,
        "description": "Block common commands used in RCE attempts."
    },  
    {
        "id": "header-attacks",
        "phase": 2,
        "pattern": "(?i)(?:1'\\s+OR\\s+'1'='1|<script[^>]*>|\\.\\.\\/\\.\\.\\/etc\\/passwd|1'\\s+UNION\\s+SELECT\\s+NULL--|\\b(?:select|insert|update|delete|drop|alter)\\b[\\s\\S]*?\\b(?:from|into|where|table)\\b|\\bunion\\b[\\s\\S]*?\\bselect\\b|'\\s*(?:and|or)\\s*['\\d]+\\s*(?:=|[<>]=?|!=)\\s*['\\d]+|\\)\\s*(?:and|or)\\s*\\([\\d]+\\s*(?:=|[<>]=?|!=)\\s*[\\d]+\\)|\\b(?:sleep|benchmark|waitfor\\s+delay)\\s*\\()",
        "targets": [
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Block SQL injection, XSS, and path traversal attempts in headers."
    },  
    {
        "id": "sensitive-files",
        "phase": 1,
        "pattern": "(?i)(?:/\\.git/(?:HEAD|index|config|refs|objects)|/\\.env(?:\\.local|\\.dev|\\.prod)?$|/\\.htaccess$|/\\.htpasswd$|/\\.svn/|/\\.DS_Store$|\\/WEB-INF\\/|\\/WEB-INF\\/web.xml|\\/META-INF\\/)",
        "targets": [
            "URI"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 9,
        "description": "Block access to sensitive files and directories (Target: URI)."
    },  
    {
        "id": "unusual-paths",
        "phase": 1,
        "pattern": "(?i)(?:/wp-admin|/phpmyadmin|/admin|/login|/cgi-bin|/shell|/backdoor|/cmd|/exec|/bin/(?:sh|bash|zsh)|/console|/setup|/test)",
        "targets": [
            "URI"
        ],
        "severity": "MEDIUM",
        "action": "block",
        "score": 7,
        "description": "Block requests to unusual or suspicious paths (Target: URI)."
    },  
    {
        "id": "exposed-admin-panels-no-referer",
        "phase": 1,
        "pattern": "(?i)^(?:/wp-admin|/phpmyadmin|/admin|/login|/cpanel|/administrator|/webmin|/siteadmin|/config)",
        "targets": [
            "URI"
        ],
        "severity": "LOW",
        "action": "log",
        "score": 3,
        "description": "Log requests to common admin panel paths."
    },  
    {
        "id": "crlf-injection-headers",
        "phase": 2,
        "pattern": "(?i)(%0d|\\r)%0a|%0a(%0d|$)|\\n",
        "targets": [
            "HEADERS"
        ],
        "severity": "MEDIUM",
        "action": "log",
        "score": 5,
        "description": "Log requests with potential CRLF injection characters in headers."
    },  
    {
        "id": "rce-command-injection-args",
        "phase": 2,
        "pattern": "(?i)(?:\\b(?:system|exec|shell_exec|passthru|popen|proc_open|pcntl_exec)\\s*\\([^\\)]*\\)|`[^`]+`|;|\\|\\||&&|\\n|%0a|%0d)",
        "targets": [
            "ARGS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Block potential RCE attempts via command injection in request arguments."
    },  
    {
        "id": "sql-injection-comment-bypass-args",
        "phase": 2,
        "pattern": "(?i)/\\*.*?\\*/|--\\s*\\r?\\n?$",
        "targets": [
            "ARGS"
        ],
        "severity": "MEDIUM",
        "action": "log",
        "score": 4,
        "description": "Log potential SQL injection comment bypass attempts in arguments."
    },  
    {
        "id": "sql-injection-improved-basic",
        "phase": 2,
        "pattern": "(?i)(?:'\\s*(?:and|or)\\s*\\d+\\s*[=<>!]+\\s*\\d+|['\"]\\s*\\d+\\s*[=<>!]+\\s*['\"]|'\\s*\\+\\s*'|--\\s*-|-{2,}|\")",
        "targets": [
            "ARGS",
            "BODY",
            "HEADERS",
            "REQUEST_COOKIES"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Improved rule to catch basic SQL injection including quotes and boolean logic."
    },  
    {
        "id": "xss-improved-encoding",
        "phase": 2,
        "pattern": "(?i)(?:<script[^>]*>|<img[^>]*\\s+onerror=|javascript:|data:|vbscript:|<svg[^>]*\\s+onload=|alert\\(|document\\.(?:cookie|location)|eval\\(|base64_(?:encode|decode)|expression\\(|\\b(?:on(?:mouse(?:over|out|down|up|move)|focus|blur|click|key(?:press|down|up)|load|error|submit|reset|change))\\s*=|\\bstyle\\s*=|(?:&#[xX]?[0-9a-fA-F]+;)+|%[0-9a-fA-F]{2,}|\\biframe[^>]*srcdoc\\s*=)",
        "targets": [
            "ARGS",
            "BODY",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Improved XSS rule to catch encoded payloads and iframe srcdoc."
    },  
    {
        "id": "rce-commands-expanded",
        "phase": 2,
        "pattern": "(?i)(?:\\b(?:cat|base64|whoami|echo|curl|wget|bash|sh|python|perl|ls|id|ping|nslookup|ipconfig|ifconfig|powershell)\\b)",
        "targets": [
            "ARGS",
            "HEADERS"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 5,
        "description": "Expanded rule to block more RCE related commands and utilities."
    },  
    {
        "id": "header-suspicious-x-forwarded-for",
        "phase": 2,
        "pattern": "(?:127\\.0\\.0\\.1|10\\.|172\\.(?:1[6-9]|2\\d|3[01])\\.|192\\.168\\.)",
        "targets": [
            "HEADERS:X-Forwarded-For"
        ],
        "severity": "MEDIUM",
        "action": "block",
        "score": 6,
        "description": "Block requests with potentially internal IPs in X-Forwarded-For."
    },  
    {
        "id": "sensitive-files-expanded",
        "phase": 1,
        "pattern": "(?i)(?:/\\.git/(?:HEAD|index|config|refs|objects)|/\\.env(?:\\.local|\\.dev|\\.prod)?$|/\\.htaccess$|/\\.htpasswd$|/\\.svn/|/\\.DS_Store$|\\/WEB-INF\\/|\\/WEB-INF\\/web.xml|\\/META-INF\\/|\\.git/\\s*(?:H\\.E\\.A\\.D|HEAD)|\\.dockerenv|server-status)",
        "targets": [
            "URI"
        ],
        "severity": "HIGH",
        "action": "block",
        "score": 9,
        "description": "Expanded rule to block access to more sensitive files and account for obfuscation."
    },  
    {
        "id": "insecure-deserialization-java",
        "phase": 2,
        "pattern": "(?:rO0AB)",
        "targets": [
            "BODY",
            "HEADERS",
            "REQUEST_COOKIES"
        ],
        "severity": "CRITICAL",
        "action": "block",
        "score": 9,
        "description": "Block requests containing potential Java serialized objects."
    },  
    {
        "id": "jwt-tampering",
        "phase": 2,
        "pattern": "(?i)(?:eyJ[A-Za-z0-9-_=]+\\.[A-Za-z0-9-_=]+\\.?[A-Za-z0-9-_.+/=]*)",
        "targets": ["HEADERS:Authorization", "COOKIES"],
        "severity": "HIGH",
        "action": "block",
        "score": 8,
        "description": "Block potential JWT tampering attempts in Authorization headers or cookies."
    },  
    {
        "id": "open-redirect-attempt",
        "phase": 2,
        "pattern": "(?i)(?:https?://(?:[^/]+@)?[^/]+\\.[^/]+/|\\b(?:redirect|url|next|return|r|u)\\b\\s*=\\s*(?:https?://|//))",
        "targets": ["ARGS", "BODY", "HEADERS"],
        "severity": "MEDIUM",
        "action": "block",
        "score": 6,
        "description": "Block potential open redirect attempts in request parameters."
    }  
]
